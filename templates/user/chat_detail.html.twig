{% extends 'base.html.twig' %}

{% block title %}
Chat con {{ otherUser ? otherUser.username : 'Usuario desconocido' }}
{% endblock %}

{% block body %}
<h1>
    Chat con {{ otherUser ? otherUser.username : 'Usuario desconocido' }}
</h1>

{# Botón para volver a todos los chats #}
<a class="btn btn-secondary mb-3" href="{{ path('user_chat', {'id': app.user.id}) }}">
    Volver a todos los chats
</a>

<div class="chat-container">
    {% if chat.messages|length > 0 %}
        <div class="chat-messages">
            {% for message in chat.messages %}
                {% set isMe = message.author and message.author.id == app.user.id %}
                <div class="chat-bubble-row {{ isMe ? 'chat-bubble-row--me' : 'chat-bubble-row--other' }}">
                    <div class="chat-bubble {{ isMe ? 'chat-bubble--me' : 'chat-bubble--other' }}">
                        <div>{{ message.text }}</div>
                        <div class="chat-bubble-time">
                            {{ message.createdAt|date('H:i d/m/Y') }}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No hay mensajes en este chat aún.</p>
    {% endif %}
</div>

{# Formulario para enviar un nuevo mensaje #}
<div class="chat-form-container">
    <form action="{{ path('user_chat_send', {'id': chat.id}) }}" method="post">
        <div class="mb-3">
            <textarea name="text" class="form-control" rows="3" placeholder="Escribe tu mensaje..." required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Enviar</button>
    </form>
</div>

{% endblock %}
