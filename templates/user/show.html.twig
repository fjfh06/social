{% extends 'base.html.twig' %}

{% block title %}User{% endblock %}

{% block body %}
    <h1>{{ user.username }}</h1>

    {# Bot√≥n seguir / dejar de seguir #}
    {% if app.user and app.user.id != user.id %}
        {% if user in app.user.following %}
            <a href="{{ path('app_user_unfollow', {'id': user.id}) }}">Dejar de seguir</a>
        {% else %}
            <a href="{{ path('app_user_follow', {'id': user.id}) }}">Seguir</a>
        {% endif %}
    {% endif %}

    <h2>Followers ({{ user.followers|length }})</h2>
    <ul>
        {% for follower in user.followers %}
            <li>
                <a href="{{ path('app_user_show', {'username': follower.username}) }}">{{ follower.username }}</a>
            </li>
        {% else %}
            <li>No followers</li>
        {% endfor %}
    </ul>

    <h2>Following ({{ user.following|length }})</h2>
    <ul>
        {% for followed in user.following %}
            <li>
                <a href="{{ path('app_user_show', {'username': followed.username}) }}">{{ followed.username }}</a>
            </li>
        {% else %}
            <li>Not following anyone</li>
        {% endfor %}
    </ul>

    <h2>Posts ({{ user.posts|length }})</h2>
    <ul>
        {% for post in user.posts %}
            <li>
                <a href="{{ path('app_post_show', {'id': post.id}) }}">
                    {{ post.text ? post.text|length > 30 ? post.text|slice(0, 30) ~ '...' : post.text : 'Image only' }}
                </a>
            </li>
        {% else %}
            <li>No posts yet</li>
        {% endfor %}
    </ul>

    <a href="{{ path('app_post_index') }}">Back to list</a>

    {# Solo el usuario mismo puede editar su perfil #}
    {% if app.user and app.user.id == user.id %}
        <a href="{{ path('app_user_edit', {'id': user.id}) }}">Edit</a>
        {{ include('user/_delete_form.html.twig') }}
    {% endif %}

    {# Admin puede eliminar cualquier usuario #}
    {% if is_granted('ROLE_ADMIN') and app.user.id != user.id %}
        {{ include('user/_delete_form.html.twig') }}
    {% endif %}

{% endblock %}
